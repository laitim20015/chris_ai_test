# æ™ºèƒ½æ–‡ä»¶è½‰æ›èˆ‡RAGçŸ¥è­˜åº«ç³»çµ±
## é …ç›®è¦æ ¼æ–‡ä»¶ v1.3

---

## æ›´æ–°æ—¥èªŒ (v1.3)

### ğŸ†• æ–°å¢å…§å®¹
1. **Azure OpenAIæœå‹™æ•´åˆ** - æ–°å¢å®Œæ•´çš„Azure OpenAI APIæ•´åˆ
2. **CandidateRankerå€™é¸æ’åºå™¨** - æ™ºèƒ½åœ–æ–‡é—œè¯æ’åºæ©Ÿåˆ¶
3. **AssociationOptimizeré—œè¯å„ªåŒ–å™¨** - é—œè¯çµæœå„ªåŒ–å’Œå»é‡
4. **CacheManagerç·©å­˜ç®¡ç†å™¨** - æ€§èƒ½å„ªåŒ–çš„å¤šå±¤ç·©å­˜ç³»çµ±
5. **APIç«¯é»æ“´å±•** - æ–°å¢/chatå’Œ/embeddingsç«¯é»
6. **æœå‹™å±¤æ¶æ§‹** - æ–°å¢servicesç›®éŒ„å’Œæœå‹™æŠ½è±¡

### ğŸ”„ æ›´æ–°å…§å®¹
1. **é—œè¯åˆ†æç®—æ³•å„ªåŒ–**
   - ç§»é™¤ç¡¬ç·¨ç¢¼çš„layout_typeè¨­ç½®
   - Captioné¡å‹åŒæ­¥æ©Ÿåˆ¶æ”¹é€²
   - åœ–ç‰‡å„ªå…ˆçš„é—œè¯ç­–ç•¥ï¼ˆå¾O(mÃ—n)å„ªåŒ–è‡³O(mÃ—log n)ï¼‰
2. **æ€§èƒ½å„ªåŒ–**
   - ç·©å­˜ç³»çµ±æ•´åˆï¼ˆ1.5xåŠ é€Ÿï¼‰
   - ä¸¦è¡Œè™•ç†èƒ½åŠ›æå‡
3. **é…ç½®ç®¡ç†å¢å¼·**
   - æ–°å¢AzureOpenAISettingsé…ç½®é¡
   - ç’°å¢ƒè®Šé‡æ”¯æŒå®Œå–„

### âŒ åˆªé™¤å…§å®¹
1. ç§»é™¤äº†åŸå§‹çš„é€ä¸€é…å°é—œè¯ç­–ç•¥
2. åˆªé™¤äº†ç¡¬ç·¨ç¢¼çš„single_columnä½ˆå±€é¡å‹

---

## 1. é …ç›®èƒŒæ™¯èˆ‡ç›®çš„

### 1.1 èƒŒæ™¯
éš¨è‘—ä¼æ¥­æ•¸å­—åŒ–è½‰å‹çš„åŠ é€Ÿï¼Œå¤§é‡çš„éçµæ§‹åŒ–æ–‡ä»¶ï¼ˆWordã€PDFã€PowerPointï¼‰éœ€è¦è¢«æœ‰æ•ˆåœ°æ•´åˆåˆ°çŸ¥è­˜ç®¡ç†ç³»çµ±ä¸­ã€‚å‚³çµ±çš„æ–‡ä»¶æª¢ç´¢æ–¹å¼ç„¡æ³•å……åˆ†åˆ©ç”¨æ–‡ä»¶ä¸­çš„åœ–åƒä¿¡æ¯ï¼Œå°è‡´çŸ¥è­˜æª¢ç´¢çš„æº–ç¢ºæ€§å’Œå®Œæ•´æ€§ä¸è¶³ã€‚

### 1.2 é …ç›®ç›®çš„
é–‹ç™¼ä¸€å€‹æ™ºèƒ½æ–‡ä»¶è½‰æ›ç³»çµ±ï¼Œèƒ½å¤ ï¼š
- å°‡å¤šç¨®æ ¼å¼æ–‡ä»¶è½‰æ›ç‚ºæ¨™æº–åŒ–çš„Markdownæ ¼å¼
- å»ºç«‹æ–‡æœ¬æ®µè½èˆ‡åœ–ç‰‡çš„æ™ºèƒ½é—œè¯é—œä¿‚
- æä¾›é«˜æ•ˆçš„RAGï¼ˆRetrieval-Augmented Generationï¼‰çŸ¥è­˜åº«ç´¢å¼•
- æ”¯æŒå¤šå¹³å°çŸ¥è­˜åº«é›†æˆï¼ˆAzure AI Searchã€Diffyã€Microsoft Copilot Studioç­‰ï¼‰
- å¯¦ç¾åœ–æ–‡ä¸¦èŒ‚çš„ç²¾æº–çŸ¥è­˜æª¢ç´¢
- **[æ–°å¢]** æä¾›Azure OpenAIé©…å‹•çš„æ™ºèƒ½å•ç­”å’Œå‘é‡åµŒå…¥æœå‹™

### 1.3 æ ¸å¿ƒåƒ¹å€¼
- **æå‡æª¢ç´¢æº–ç¢ºæ€§**ï¼šé€šéåœ–æ–‡é—œè¯ï¼Œæä¾›æ›´å®Œæ•´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
- **æ¨™æº–åŒ–è™•ç†**ï¼šçµ±ä¸€çš„Markdownæ ¼å¼ä¾¿æ–¼å¤šå¹³å°é›†æˆ
- **æ™ºèƒ½é—œè¯**ï¼šè‡ªå‹•è­˜åˆ¥åœ–ç‰‡èˆ‡æ–‡æœ¬çš„èªç¾©é—œä¿‚
- **å¯æ“´å±•æ€§**ï¼šæ”¯æŒå¤šç¨®æ–‡ä»¶æ ¼å¼å’ŒçŸ¥è­˜åº«å¹³å°
- **[æ–°å¢] AIå¢å¼·**ï¼šæ•´åˆAzure OpenAIå¯¦ç¾æ™ºèƒ½å•ç­”å’Œèªç¾©ç†è§£

---

## 2. ç³»çµ±è¨­è¨ˆæ¶æ§‹

### 2.1 æ•´é«”æ¶æ§‹
```
æ–‡ä»¶è¼¸å…¥ â†’ æ ¼å¼è§£æ â†’ å…§å®¹æå– â†’ åœ–æ–‡é—œè¯ â†’ Markdownç”Ÿæˆ â†’ çŸ¥è­˜åº«é›†æˆ â†’ AIæœå‹™
    â†“           â†“           â†“           â†“           â†“            â†“            â†“
  å¤šæ ¼å¼     çµæ§‹åŒ–è§£æ   æ–‡æœ¬+åœ–ç‰‡   æ™ºèƒ½åŒ¹é…   æ¨™æº–åŒ–è¼¸å‡º   RAGç´¢å¼•    å•ç­”/åµŒå…¥
```

### 2.2 æ ¸å¿ƒæ¨¡çµ„
1. **æ–‡ä»¶è§£ææ¨¡çµ„**ï¼ˆFile Parser Moduleï¼‰
2. **åœ–ç‰‡è™•ç†æ¨¡çµ„**ï¼ˆImage Processing Moduleï¼‰  
3. **é—œè¯åˆ†ææ¨¡çµ„**ï¼ˆAssociation Analysis Moduleï¼‰- **[æ›´æ–°]** æ–°å¢CandidateRanker
4. **Markdownç”Ÿæˆæ¨¡çµ„**ï¼ˆMarkdown Generator Moduleï¼‰
5. **å­˜å„²ç®¡ç†æ¨¡çµ„**ï¼ˆStorage Management Moduleï¼‰
6. **çŸ¥è­˜åº«é›†æˆæ¨¡çµ„**ï¼ˆKnowledge Base Integration Moduleï¼‰
7. **[æ–°å¢] æœå‹™å±¤æ¨¡çµ„**ï¼ˆService Layer Moduleï¼‰- Azure OpenAIé›†æˆ
8. **[æ–°å¢] APIæ¥å£æ¨¡çµ„**ï¼ˆAPI Interface Moduleï¼‰- RESTful APIæ“´å±•

### 2.3 æ•¸æ“šæµè¨­è¨ˆ
```
åŸå§‹æ–‡ä»¶ 
  â”œâ”€â”€ æ–‡æœ¬å…§å®¹æå–
  â”œâ”€â”€ åœ–ç‰‡è³‡æºæå–
  â”œâ”€â”€ çµæ§‹ä¿¡æ¯è§£æ
  â””â”€â”€ å…ƒæ•¸æ“šæ”¶é›†
       â†“
å€™é¸ç¯©é¸èˆ‡æ’åº [æ–°å¢]
  â”œâ”€â”€ CandidateRankeræ™ºèƒ½æ’åº
  â”œâ”€â”€ åœ–ç‰‡å„ªå…ˆç­–ç•¥
  â””â”€â”€ å¤šç¶­åº¦è©•åˆ†
       â†“
æ®µè½-åœ–ç‰‡é—œè¯åˆ†æ
  â”œâ”€â”€ ä½ç½®é—œä¿‚åˆ†æ
  â”œâ”€â”€ èªç¾©ç›¸ä¼¼åº¦è¨ˆç®—
  â””â”€â”€ é—œè¯åº¦è©•åˆ†
       â†“
é—œè¯å„ªåŒ–è™•ç† [æ–°å¢]
  â”œâ”€â”€ CaptionåŠ æˆåŒæ­¥
  â”œâ”€â”€ é‡è¤‡é—œè¯å»é‡
  â””â”€â”€ è³ªé‡åˆ†ç´š
       â†“
Markdownæ–‡ä»¶ç”Ÿæˆ
  â”œâ”€â”€ æ–‡æœ¬çµæ§‹åŒ–
  â”œâ”€â”€ åœ–ç‰‡URLæ›¿æ›
  â””â”€â”€ å…ƒæ•¸æ“šåµŒå…¥
       â†“
çŸ¥è­˜åº«ç´¢å¼•å»ºç«‹
  â”œâ”€â”€ åˆ†å¡Šç­–ç•¥
  â”œâ”€â”€ å‘é‡åŒ–
  â””â”€â”€ é—œè¯é—œä¿‚å­˜å„²
       â†“
AIæœå‹™å±¤ [æ–°å¢]
  â”œâ”€â”€ Chatå•ç­”æœå‹™
  â”œâ”€â”€ Embeddingå‘é‡æœå‹™
  â””â”€â”€ RAGå¢å¼·æª¢ç´¢
```

---

## 3. æŠ€è¡“æ–¹æ¡ˆè¨­è¨ˆ

### 3.1 æ–‡ä»¶è§£ææŠ€è¡“æ£§

#### 3.1.1 Wordæ–‡ä»¶è™•ç†
- **ä¸»è¦åº«**ï¼š`python-docx`ã€`mammoth`
- **åŠŸèƒ½**ï¼š
  - æå–æ–‡æœ¬å…§å®¹å’Œæ ¼å¼ä¿¡æ¯
  - æå–åµŒå…¥åœ–ç‰‡å’Œåœ–è¡¨
  - ä¿ç•™æ®µè½çµæ§‹å’Œæ¨™é¡Œå±¤ç´š
  - è™•ç†è¡¨æ ¼å’Œåˆ—è¡¨

#### 3.1.2 PDFæ–‡ä»¶è™•ç†
- **ä¸»è¦åº«**ï¼š`PyMuPDF (fitz)`ã€`pymupdf4llm`ã€`unstructured`
- **æ¨è–¦å±¤ç´š**ï¼š
  1. **PyMuPDF** - æœ€ä½³æ€§èƒ½ (0.003-0.2ç§’)
  2. **pymupdf4llm** - æœ€ä½³Markdownè¼¸å‡º (0.12ç§’)
  3. **unstructured** - æœ€ä½³èªç¾©åˆ†å¡Š (1.29ç§’)
- **åŠŸèƒ½**ï¼š
  - å…§å»ºOCRæ”¯æŒï¼Œç„¡éœ€é¡å¤–ä¾è³´
  - åŸç”Ÿè¡¨æ ¼å’Œåœ–ç‰‡æå–
  - ç›´æ¥è¼¸å‡ºçµæ§‹åŒ–Markdown
  - èªç¾©æ„ŸçŸ¥çš„å…§å®¹åˆ†å¡Š

#### 3.1.3 PowerPointæ–‡ä»¶è™•ç†
- **ä¸»è¦åº«**ï¼š`python-pptx`ã€`comtypes`
- **åŠŸèƒ½**ï¼š
  - å¹»ç‡ˆç‰‡å…§å®¹æå–
  - åœ–ç‰‡å’Œåœ–è¡¨æå–
  - æ¼”è¬›è€…å‚™è¨»è™•ç†
  - å‹•ç•«å’Œéæ¸¡æ•ˆæœå¿½ç•¥

### 3.2 åœ–ç‰‡è™•ç†èˆ‡å­˜å„²

#### 3.2.1 åœ–ç‰‡è™•ç†æµç¨‹
```python
åŸå§‹åœ–ç‰‡ â†’ æ ¼å¼æ¨™æº–åŒ– â†’ å°ºå¯¸å„ªåŒ– â†’ è³ªé‡å£“ç¸® â†’ å‘½åè¦ç¯„ â†’ å­˜å„²ä¸Šå‚³
```

#### 3.2.2 å‘½åè¦ç¯„
```
{æ–‡ä»¶å}_{é ç¢¼/å¹»ç‡ˆç‰‡è™Ÿ}_{åœ–ç‰‡åºè™Ÿ}_{æ™‚é–“æˆ³}.{æ ¼å¼}
ä¾‹ï¼šreport_p003_img001_20240315143022.jpg
```

#### 3.2.3 å­˜å„²æ–¹æ¡ˆ
- **æœ¬åœ°å­˜å„²**ï¼šé–‹ç™¼å’Œæ¸¬è©¦éšæ®µ
- **é›²ç«¯å­˜å„²**ï¼š
  - Azure Blob Storage
  - AWS S3
  - Google Cloud Storage
- **CDNåŠ é€Ÿ**ï¼šæé«˜åœ–ç‰‡è¨ªå•é€Ÿåº¦

### 3.3 åœ–æ–‡é—œè¯ç®—æ³• **[æ›´æ–°]**

#### 3.3.1 å¤šå±¤æ¬¡ç©ºé–“é—œè¯åˆ†æ
åŸºæ–¼Allenæ™‚é–“é–“éš”é‚è¼¯çš„13ç¨®ç©ºé–“é—œä¿‚ï¼š

```python
class SpatialAssociationAnalyzer:
    def __init__(self):
        self.spatial_relations = {
            "precedes": "<",     # åœ¨...ä¹‹å‰
            "meets": "|",        # ç·Šé„°
            "overlaps": "o",     # é‡ç–Š
            "during": "d",       # åœ¨...æœŸé–“
            "above": "^",        # åœ¨...ä¸Šæ–¹
            "below": "v",        # åœ¨...ä¸‹æ–¹
            "adjacent": "~",     # é„°æ¥
            # åŠ ä¸Šé€†é—œä¿‚
        }
    
    def analyze_multi_level_relations(self, text_blocks, images):
        """å¤šå±¤æ¬¡ç©ºé–“é—œè¯åˆ†æ"""
        return {
            "geometric": self.geometric_analysis(text_blocks, images),
            "layout": self.layout_pattern_analysis(text_blocks, images),
            "semantic": self.semantic_proximity_analysis(text_blocks, images),
            "caption": self.caption_detection(text_blocks, images)
        }
```

#### 3.3.2 Captionæª¢æ¸¬ç®—æ³•ï¼ˆæœ€é—œéµï¼‰
```python
def detect_caption_relationship(self, image, text_block):
    """æª¢æ¸¬åœ–ç‰‡æ¨™é¡Œé—œä¿‚ - æœ€é‡è¦çš„é—œè¯æŒ‡æ¨™"""
    caption_patterns = [
        r'^(Figure|Fig|åœ–|è¡¨|Table)\s*\d+',
        r'^(Chart|Diagram|Image)\s*\d+',
        r'å¦‚åœ–\s*\d+|è¦‹åœ–\s*\d+',
        r'ä¸‹åˆ—åœ–è¡¨|ä¸Šåœ–|ä¸‹åœ–'  # [æ–°å¢] æ“´å±•çš„Captionæ¨¡å¼
    ]
    
    text_content = text_block.get_text()
    
    # æª¢æŸ¥æ˜¯å¦åŒ…å«åœ–ç‰‡å¼•ç”¨
    for pattern in caption_patterns:
        if re.search(pattern, text_content, re.IGNORECASE):
            return 0.9  # é«˜åˆ†
    
    # æª¢æŸ¥ä½ç½®é—œä¿‚ (æ¨™é¡Œé€šå¸¸åœ¨åœ–ç‰‡ä¸‹æ–¹æˆ–ä¸Šæ–¹)
    if self.is_caption_positioned(image, text_block):
        return 0.7
        
    return 0.1
```

#### 3.3.3 å¢å¼·çš„é—œè¯åº¦è©•åˆ†æ¨¡å‹
```python
# æ›´æ–°çš„æ¬Šé‡åˆ†é…ï¼ˆåŸºæ–¼æœ€æ–°ç ”ç©¶ï¼‰
final_score = (
    w1 * caption_score +      # 0.4 - æœ€é«˜æ¬Šé‡
    w2 * spatial_score +      # 0.3 - ç©ºé–“é—œä¿‚
    w3 * semantic_score +     # 0.15 - èªç¾©ç›¸ä¼¼åº¦
    w4 * layout_score +       # 0.1 - ä½ˆå±€æ¨¡å¼
    w5 * proximity_score      # 0.05 - è·é›¢æ¬Šé‡
)
```

#### 3.3.4 **[æ–°å¢] å€™é¸æ’åºå™¨ï¼ˆCandidateRankerï¼‰**
```python
class CandidateRanker:
    """æ™ºèƒ½å€™é¸æ’åºå™¨ - å¯¦ç¾O(mÃ—log n)è¤‡é›œåº¦å„ªåŒ–"""
    
    def rank_candidates(self, text_candidates, image_bbox, context_info):
        """
        å°å€™é¸æ–‡æœ¬é€²è¡Œæ™ºèƒ½æ’åº
        - åœ–ç‰‡å„ªå…ˆç­–ç•¥
        - å¤šç¶­åº¦è©•åˆ†èåˆ
        - å„ªå…ˆç´šè¦å‰‡æ‡‰ç”¨
        """
        scored_candidates = []
        for candidate in text_candidates:
            score = self._score_candidate(candidate, image_bbox, context_info)
            scored_candidates.append(RankedCandidate(
                text_id=candidate.id,
                scores=score,
                is_recommended=score.final_score >= threshold
            ))
        
        return self._apply_ranking_and_priority(scored_candidates)
```

#### 3.3.5 **[æ–°å¢] é—œè¯å„ªåŒ–å™¨ï¼ˆAssociationOptimizerï¼‰**
```python
class AssociationOptimizer:
    """é—œè¯çµæœå„ªåŒ–å™¨"""
    
    def optimize_associations(self, associations, images, text_blocks):
        """
        å„ªåŒ–é—œè¯çµæœ
        - CaptionåŠ æˆåŒæ­¥
        - é‡è¤‡é—œè¯å»é‡
        - è³ªé‡åˆ†ç´š
        - æ•¸é‡æ§åˆ¶
        """
        # Captioné¡å‹åŒæ­¥æ›´æ–°
        for assoc in associations:
            if assoc["caption_detected"] and assoc["caption_score"] >= 0.8:
                assoc["association_type"] = "caption"  # åŒæ­¥æ›´æ–°é¡å‹
                assoc["adjusted_score"] = assoc["final_score"] * 1.5
```

### 3.4 **[æ–°å¢] Azure OpenAIé›†æˆ**

#### 3.4.1 æœå‹™é…ç½®
```python
class AzureOpenAISettings:
    endpoint: str = "https://your-resource.openai.azure.com/"
    api_key: str = os.getenv("AZURE_OPENAI_API_KEY")
    api_version: str = "2024-02-01"
    chat_deployment_name: str = "gpt-4"
    embedding_deployment_name: str = "text-embedding-ada-002"
    max_tokens: int = 4000
    temperature: float = 0.7
    max_requests_per_minute: int = 60
    max_tokens_per_minute: int = 150000
```

#### 3.4.2 Chatæœå‹™
```python
class AzureOpenAIService:
    async def chat_completion(self, messages, model, temperature):
        """æ™ºèƒ½å°è©±å®Œæˆ"""
        # é€Ÿç‡é™åˆ¶
        await self.rate_limiter.acquire()
        
        # Tokenè¨ˆæ•¸
        token_count = self.count_tokens(messages)
        
        # APIèª¿ç”¨
        response = await self.client.chat.completions.create(
            model=model,
            messages=messages,
            temperature=temperature
        )
        
        return self._format_response(response)
```

#### 3.4.3 Embeddingæœå‹™
```python
async def create_embeddings(self, texts, batch_size=10):
    """æ‰¹é‡æ–‡æœ¬å‘é‡åŒ–"""
    embeddings = []
    
    for batch in self._batch_texts(texts, batch_size):
        response = await self.client.embeddings.create(
            model=self.embedding_model,
            input=batch
        )
        embeddings.extend(response.embeddings)
    
    return embeddings
```

### 3.5 **[æ–°å¢] ç·©å­˜ç³»çµ±è¨­è¨ˆ**

```python
class CacheManager:
    """å¤šå±¤ç·©å­˜ç®¡ç†å™¨"""
    
    def __init__(self):
        self.caches = {
            'spatial': LRUCache(max_size=1000),
            'semantic': LRUCache(max_size=500),
            'caption': LRUCache(max_size=2000),
            'layout': LRUCache(max_size=100)
        }
    
    def get_cached_result(self, cache_type, key):
        """ç²å–ç·©å­˜çµæœï¼Œæä¾›1.5xæ€§èƒ½æå‡"""
        return self.caches[cache_type].get(key)
```

---

## 4. é …ç›®çµæ§‹è¨­è¨ˆ **[æ›´æ–°]**

### 4.1 å®Œæ•´ç›®éŒ„çµæ§‹

```
AP_Project_RAG/
â”œâ”€â”€ é …ç›®è¦æ ¼æ–‡ä»¶_æ–‡ä»¶è½‰æ›RAGç³»çµ±.md      # ğŸ¯ ä¸»è¦é …ç›®è¦æ ¼æ–‡ä»¶
â”œâ”€â”€ README.md                           # é …ç›®ç°¡ä»‹å’Œå¿«é€Ÿé–‹å§‹æŒ‡å—
â”œâ”€â”€ requirements.txt                    # Pythonä¾è³´åŒ…
â”œâ”€â”€ pyproject.toml                      # é …ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ .env.example                        # ç’°å¢ƒè®Šé‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                          # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ docker-compose.yml                  # Dockerå®¹å™¨ç·¨æ’
â”œâ”€â”€ Dockerfile                          # Dockeré¡åƒæ§‹å»º
â”‚
â”œâ”€â”€ docs/                               # ğŸ“š é …ç›®æ–‡æª”ç›®éŒ„
â”‚   â”œâ”€â”€ project_structure.md            # ğŸ—ï¸ é …ç›®çµæ§‹è©³ç´°èªªæ˜
â”‚   â”œâ”€â”€ api/                            # APIæ–‡æª”
â”‚   â”‚   â”œâ”€â”€ openapi.yaml                # OpenAPIè¦ç¯„
â”‚   â”‚   â”œâ”€â”€ api_guide.md                # APIä½¿ç”¨æŒ‡å—
â”‚   â”‚   â””â”€â”€ quick_start.md              # [æ–°å¢] å¿«é€Ÿé–‹å§‹æŒ‡å—
â”‚   â”œâ”€â”€ user_guide/                     # ğŸ‘¥ ç”¨æˆ¶æŒ‡å—
â”‚   â”‚   â”œâ”€â”€ installation.md             # å®‰è£æŒ‡å—
â”‚   â”‚   â”œâ”€â”€ quick_start.md              # å¿«é€Ÿé–‹å§‹
â”‚   â”‚   â””â”€â”€ advanced_usage.md           # é«˜ç´šç”¨æ³•
â”‚   â”œâ”€â”€ developer_guide/                # ğŸ‘¨â€ğŸ’» é–‹ç™¼è€…æŒ‡å—
â”‚   â”‚   â”œâ”€â”€ architecture.md             # æ¶æ§‹èªªæ˜
â”‚   â”‚   â”œâ”€â”€ contributing.md             # è²¢ç»æŒ‡å—
â”‚   â”‚   â””â”€â”€ coding_standards.md         # ç·¨ç¢¼è¦ç¯„
â”‚   â”œâ”€â”€ technical_specs/                # ğŸ”¬ æŠ€è¡“è¦æ ¼
â”‚   â”‚   â”œâ”€â”€ spatial_analysis.md         # ç©ºé–“åˆ†æç®—æ³•è©³è§£
â”‚   â”‚   â”œâ”€â”€ caption_detection.md        # Captionæª¢æ¸¬ç®—æ³•
â”‚   â”‚   â”œâ”€â”€ association_algorithm.md    # [æ–°å¢] é—œè¯ç®—æ³•è©³è§£
â”‚   â”‚   â””â”€â”€ performance_benchmarks.md   # æ€§èƒ½åŸºæº–æ¸¬è©¦
â”‚   â””â”€â”€ deployment/                     # ğŸš€ éƒ¨ç½²æ–‡æª”
â”‚       â”œâ”€â”€ local_deployment.md         # æœ¬åœ°éƒ¨ç½²
â”‚       â”œâ”€â”€ cloud_deployment.md         # é›²ç«¯éƒ¨ç½²
â”‚       â””â”€â”€ scaling_guide.md            # æ“´å±•æŒ‡å—
â”‚
â”œâ”€â”€ src/                                # ğŸ”§ ä¸»è¦æºä»£ç¢¼ç›®éŒ„
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                         # æ‡‰ç”¨ç¨‹åºå…¥å£é» [æ›´æ–°]
â”‚   â”œâ”€â”€ config/                         # âš™ï¸ é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ settings.py                 # æ‡‰ç”¨é…ç½® [æ›´æ–°ï¼šæ–°å¢AzureOpenAIé…ç½®]
â”‚   â”‚   â””â”€â”€ logging_config.py           # æ—¥èªŒé…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ parsers/                        # ğŸ“„ æ–‡ä»¶è§£ææ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                     # è§£æå™¨åŸºé¡
â”‚   â”‚   â”œâ”€â”€ pdf_parser.py               # PDFè§£æå™¨ (PyMuPDF + pymupdf4llm)
â”‚   â”‚   â”œâ”€â”€ word_parser.py              # Wordè§£æå™¨ (python-docx)
â”‚   â”‚   â”œâ”€â”€ ppt_parser.py               # PowerPointè§£æå™¨ (python-pptx)
â”‚   â”‚   â””â”€â”€ parser_factory.py           # è§£æå™¨å·¥å» æ¨¡å¼
â”‚   â”‚
â”‚   â”œâ”€â”€ image_processing/               # ğŸ–¼ï¸ åœ–ç‰‡è™•ç†æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ extractor.py                # åœ–ç‰‡æå–å™¨
â”‚   â”‚   â”œâ”€â”€ optimizer.py                # åœ–ç‰‡å„ªåŒ–å™¨ (å£“ç¸®ã€æ ¼å¼è½‰æ›)
â”‚   â”‚   â”œâ”€â”€ storage.py                  # åœ–ç‰‡å­˜å„²ç®¡ç† (æœ¬åœ°/é›²ç«¯)
â”‚   â”‚   â””â”€â”€ metadata.py                 # åœ–ç‰‡å…ƒæ•¸æ“šè™•ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ association/                    # ğŸ¯ åœ–æ–‡é—œè¯åˆ†ææ¨¡çµ„ (æ ¸å¿ƒ) [æ›´æ–°]
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ spatial_analyzer.py         # ç©ºé–“é—œä¿‚åˆ†æå™¨ [æ›´æ–°ï¼šå‹•æ…‹ä½ˆå±€]
â”‚   â”‚   â”œâ”€â”€ allen_logic.py              # Allenå€é–“é‚è¼¯å¯¦ç¾
â”‚   â”‚   â”œâ”€â”€ caption_detector.py         # Captionæª¢æ¸¬å™¨ (40%æ¬Šé‡)
â”‚   â”‚   â”œâ”€â”€ semantic_analyzer.py        # èªç¾©åˆ†æå™¨ (sentence-transformers)
â”‚   â”‚   â”œâ”€â”€ association_scorer.py       # é—œè¯åº¦è©•åˆ†å™¨
â”‚   â”‚   â”œâ”€â”€ candidate_ranker.py         # [æ–°å¢] å€™é¸æ’åºå™¨
â”‚   â”‚   â”œâ”€â”€ association_optimizer.py    # [æ–°å¢] é—œè¯å„ªåŒ–å™¨
â”‚   â”‚   â””â”€â”€ cache_manager.py            # [æ–°å¢] ç·©å­˜ç®¡ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ markdown/                       # ğŸ“ Markdownç”Ÿæˆæ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ generator.py                # Markdownç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ templates/                  # Jinja2æ¨¡æ¿æ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ basic.md.j2             # åŸºç¤æ¨¡æ¿
â”‚   â”‚   â”‚   â””â”€â”€ enhanced.md.j2          # å¢å¼·æ¨¡æ¿ (åŒ…å«é—œè¯ä¿¡æ¯)
â”‚   â”‚   â””â”€â”€ formatter.py                # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ knowledge_base/                 # ğŸ§  çŸ¥è­˜åº«é›†æˆæ¨¡çµ„ [æ›´æ–°]
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_adapter.py             # é©é…å™¨åŸºé¡
â”‚   â”‚   â”œâ”€â”€ adapter_factory.py          # [æ–°å¢] é©é…å™¨å·¥å» 
â”‚   â”‚   â”œâ”€â”€ azure_ai_search.py          # Azure AI Searché©é…å™¨
â”‚   â”‚   â”œâ”€â”€ diffy_adapter.py            # Diffyé©é…å™¨
â”‚   â”‚   â””â”€â”€ copilot_studio.py           # Microsoft Copilot Studioé©é…å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                       # ğŸŒ [æ–°å¢] æœå‹™å±¤æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ azure_openai_service.py     # Azure OpenAIæœå‹™
â”‚   â”‚   â””â”€â”€ document_service.py         # æ–‡æª”è™•ç†æœå‹™
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                          # ğŸ”¨ å·¥å…·æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ file_utils.py               # æ–‡ä»¶æ“ä½œå·¥å…·
â”‚   â”‚   â”œâ”€â”€ text_utils.py               # æ–‡æœ¬è™•ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ image_utils.py              # åœ–åƒè™•ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ validation.py               # æ•¸æ“šé©—è­‰å·¥å…·
â”‚   â”‚   â”œâ”€â”€ error_handling.py           # [æ–°å¢] éŒ¯èª¤è™•ç†å·¥å…·
â”‚   â”‚   â””â”€â”€ performance_benchmarks.py   # [æ–°å¢] æ€§èƒ½åŸºæº–å·¥å…·
â”‚   â”‚
â”‚   â””â”€â”€ api/                            # ğŸŒ APIæ¥å£æ¨¡çµ„ (FastAPI) [æ›´æ–°]
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ app.py                      # [æ–°å¢] FastAPIæ‡‰ç”¨å¯¦ä¾‹
â”‚       â”œâ”€â”€ main.py                     # [æ–°å¢] APIæœå‹™å…¥å£
â”‚       â”œâ”€â”€ routes/                     # APIè·¯ç”±
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ upload.py               # æ–‡ä»¶ä¸Šå‚³API
â”‚       â”‚   â”œâ”€â”€ process.py              # è™•ç†API
â”‚       â”‚   â”œâ”€â”€ download.py             # çµæœä¸‹è¼‰API
â”‚       â”‚   â”œâ”€â”€ status.py               # [æ–°å¢] è™•ç†ç‹€æ…‹API
â”‚       â”‚   â”œâ”€â”€ chat.py                 # [æ–°å¢] AIå°è©±API
â”‚       â”‚   â””â”€â”€ embeddings.py           # [æ–°å¢] å‘é‡åµŒå…¥API
â”‚       â”œâ”€â”€ models/                     # Pydanticæ•¸æ“šæ¨¡å‹
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ request_models.py       # è«‹æ±‚æ¨¡å‹
â”‚       â”‚   â””â”€â”€ response_models.py      # éŸ¿æ‡‰æ¨¡å‹
â”‚       â””â”€â”€ middleware/                 # ä¸­é–“ä»¶
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ auth.py                 # èªè­‰ä¸­é–“ä»¶
â”‚           â”œâ”€â”€ rate_limit.py           # é™æµä¸­é–“ä»¶
â”‚           â””â”€â”€ error_handler.py        # [æ–°å¢] éŒ¯èª¤è™•ç†ä¸­é–“ä»¶
â”‚
â”œâ”€â”€ tests/                              # ğŸ§ª æ¸¬è©¦ç›®éŒ„
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py                     # [æ–°å¢] Pytesté…ç½®
â”‚   â”œâ”€â”€ unit/                           # å–®å…ƒæ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ test_parsers/               # è§£æå™¨æ¸¬è©¦
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ test_pdf_parser.py      # PDFè§£æå™¨æ¸¬è©¦
â”‚   â”‚   â”‚   â”œâ”€â”€ test_word_parser.py     # Wordè§£æå™¨æ¸¬è©¦
â”‚   â”‚   â”‚   â””â”€â”€ test_ppt_parser.py      # PPTè§£æå™¨æ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ test_association/           # é—œè¯åˆ†ææ¸¬è©¦
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ test_spatial_analyzer.py    # ç©ºé–“åˆ†ææ¸¬è©¦
â”‚   â”‚   â”‚   â”œâ”€â”€ test_caption_detector.py    # Captionæª¢æ¸¬æ¸¬è©¦
â”‚   â”‚   â”‚   â””â”€â”€ test_association_scorer.py  # è©•åˆ†å™¨æ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ test_api/                   # [æ–°å¢] APIæ¸¬è©¦
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ test_chat_endpoints.py  # Chatç«¯é»æ¸¬è©¦
â”‚   â”‚   â””â”€â”€ test_utils/                 # å·¥å…·å‡½æ•¸æ¸¬è©¦
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ test_file_utils.py      # æ–‡ä»¶å·¥å…·æ¸¬è©¦
â”‚   â”‚       â””â”€â”€ test_validation.py      # é©—è­‰å·¥å…·æ¸¬è©¦
â”‚   â”œâ”€â”€ integration/                    # é›†æˆæ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_end_to_end.py          # ç«¯åˆ°ç«¯æ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ test_production_entry.py    # [æ–°å¢] ç”Ÿç”¢å…¥å£æ¸¬è©¦
â”‚   â”‚   â””â”€â”€ test_workflow.py            # å·¥ä½œæµæ¸¬è©¦
â”‚   â”œâ”€â”€ performance/                    # æ€§èƒ½æ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_benchmarks.py          # åŸºæº–æ¸¬è©¦
â”‚   â”‚   â””â”€â”€ test_load.py                # è² è¼‰æ¸¬è©¦
â”‚   â”œâ”€â”€ test_data_generator.py          # [æ–°å¢] æ¸¬è©¦æ•¸æ“šç”Ÿæˆå™¨
â”‚   â””â”€â”€ fixtures/                       # æ¸¬è©¦æ•¸æ“š
â”‚       â”œâ”€â”€ documents/                  # æ¸¬è©¦æ–‡æª”
â”‚       â”‚   â”œâ”€â”€ sample.pdf              # æ¸¬è©¦PDFæ–‡ä»¶
â”‚       â”‚   â”œâ”€â”€ sample.docx             # æ¸¬è©¦Wordæ–‡ä»¶
â”‚       â”‚   â””â”€â”€ sample.pptx             # æ¸¬è©¦PPTæ–‡ä»¶
â”‚       â”œâ”€â”€ images/                     # æ¸¬è©¦åœ–ç‰‡
â”‚       â”‚   â”œâ”€â”€ chart_sample.jpg        # åœ–è¡¨æ¨£æœ¬
â”‚       â”‚   â”œâ”€â”€ diagram_sample.png      # åœ–ç¤ºæ¨£æœ¬
â”‚       â”‚   â””â”€â”€ table_sample.png        # [æ–°å¢] è¡¨æ ¼æ¨£æœ¬
â”‚       â””â”€â”€ expected_outputs/           # é æœŸè¼¸å‡ºçµæœ
â”‚           â”œâ”€â”€ sample_output.md        # é æœŸMarkdownè¼¸å‡º
â”‚           â””â”€â”€ associations.json       # é æœŸé—œè¯çµæœ
â”‚
â”œâ”€â”€ scripts/                            # ğŸ“œ è…³æœ¬ç›®éŒ„
â”‚   â”œâ”€â”€ setup.py                        # ç’°å¢ƒè¨­ç½®è…³æœ¬
â”‚   â”œâ”€â”€ migrate.py                      # æ•¸æ“šé·ç§»è…³æœ¬
â”‚   â”œâ”€â”€ benchmark.py                    # æ€§èƒ½åŸºæº–æ¸¬è©¦è…³æœ¬
â”‚   â”œâ”€â”€ update_docs.py                  # æ–‡æª”æ›´æ–°è…³æœ¬
â”‚   â”œâ”€â”€ clean_temp.py                   # æ¸…ç†è‡¨æ™‚æ–‡ä»¶è…³æœ¬
â”‚   â”œâ”€â”€ deploy.py                       # éƒ¨ç½²è…³æœ¬
â”‚   â”œâ”€â”€ migrate_metadata.py             # [æ–°å¢] å…ƒæ•¸æ“šé·ç§»è…³æœ¬
â”‚   â”œâ”€â”€ rename_images.py                # [æ–°å¢] åœ–ç‰‡é‡å‘½åè…³æœ¬
â”‚   â””â”€â”€ run_tests.py                    # [æ–°å¢] æ¸¬è©¦åŸ·è¡Œè…³æœ¬
â”‚
â”œâ”€â”€ data/                               # ğŸ’¾ æ•¸æ“šç›®éŒ„
â”‚   â”œâ”€â”€ input/                          # è¼¸å…¥æ–‡ä»¶ç›®éŒ„
â”‚   â”‚   â”œâ”€â”€ documents/                  # å¾…è™•ç†æ–‡æª”
â”‚   â”‚   â””â”€â”€ batch/                      # æ‰¹é‡è™•ç†æ–‡ä»¶
â”‚   â”œâ”€â”€ output/                         # è¼¸å‡ºæ–‡ä»¶ç›®éŒ„
â”‚   â”‚   â”œâ”€â”€ markdown/                   # ç”Ÿæˆçš„Markdownæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ images/                     # è™•ç†å¾Œçš„åœ–ç‰‡
â”‚   â”‚   â””â”€â”€ metadata/                   # å…ƒæ•¸æ“šæ–‡ä»¶
â”‚   â”œâ”€â”€ temp/                           # è‡¨æ™‚æ–‡ä»¶ç›®éŒ„
â”‚   â”‚   â”œâ”€â”€ processing/                 # è™•ç†ä¸­çš„æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ cache/                      # ç·©å­˜æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ image_backup/               # [æ–°å¢] åœ–ç‰‡å‚™ä»½
â”‚   â”‚   â””â”€â”€ metadata_backup/            # [æ–°å¢] å…ƒæ•¸æ“šå‚™ä»½
â”‚   â””â”€â”€ models/                         # æ©Ÿå™¨å­¸ç¿’æ¨¡å‹
â”‚       â”œâ”€â”€ sentence_transformers/      # èªç¾©æ¨¡å‹
â”‚       â””â”€â”€ custom/                     # è‡ªå®šç¾©æ¨¡å‹
â”‚
â”œâ”€â”€ logs/                               # ğŸ“‹ [æ–°å¢] æ—¥èªŒç›®éŒ„
â”‚   â”œâ”€â”€ app.log                         # æ‡‰ç”¨æ—¥èªŒ
â”‚   â””â”€â”€ cleanup_report.md               # æ¸…ç†å ±å‘Š
â”‚
â””â”€â”€ deploy/                             # ğŸš€ éƒ¨ç½²é…ç½®
    â”œâ”€â”€ k8s/                            # Kubernetesé…ç½®
    â”‚   â”œâ”€â”€ namespace.yaml              # å‘½åç©ºé–“é…ç½®
    â”‚   â”œâ”€â”€ deployment.yaml             # éƒ¨ç½²é…ç½®
    â”‚   â”œâ”€â”€ service.yaml                # æœå‹™é…ç½®
    â”‚   â””â”€â”€ ingress.yaml                # å…¥å£é…ç½®
    â”œâ”€â”€ terraform/                      # TerraformåŸºç¤è¨­æ–½
    â”‚   â”œâ”€â”€ main.tf                     # ä¸»è¦é…ç½®
    â”‚   â”œâ”€â”€ variables.tf                # è®Šé‡å®šç¾©
    â”‚   â””â”€â”€ outputs.tf                  # è¼¸å‡ºå®šç¾©
    â””â”€â”€ ansible/                        # Ansibleè‡ªå‹•åŒ–éƒ¨ç½²
        â”œâ”€â”€ playbook.yml                # éƒ¨ç½²åŠ‡æœ¬
        â”œâ”€â”€ inventory.ini               # ä¸»æ©Ÿæ¸…å–®
        â””â”€â”€ roles/                      # è§’è‰²å®šç¾©
            â”œâ”€â”€ app/                    # æ‡‰ç”¨è§’è‰²
            â””â”€â”€ database/               # æ•¸æ“šåº«è§’è‰²
```

### 4.2 æ ¸å¿ƒæ¨¡çµ„æ¶æ§‹è¨­è¨ˆ **[æ›´æ–°]**

#### 4.2.1 è§£æå™¨æ¨¡çµ„æ¶æ§‹
åŸºæ–¼é–‹æ”¾å°é–‰åŸå‰‡å’Œå·¥å» æ¨¡å¼è¨­è¨ˆçš„æ–‡ä»¶è§£ææ¶æ§‹ï¼Œæ”¯æŒå¤šç¨®æ–‡ä»¶æ ¼å¼çš„çµ±ä¸€è™•ç†ã€‚

#### 4.2.2 é—œè¯åˆ†ææ¨¡çµ„æ¶æ§‹ **[æ›´æ–°]** 
- åŸºæ–¼Allenå€é–“é‚è¼¯çš„ç©ºé–“é—œä¿‚åˆ†æå™¨
- Captionæª¢æ¸¬(40%æ¬Šé‡)å’Œå¤šå±¤æ¬¡ç©ºé–“ç‰¹å¾µæå–
- **[æ–°å¢]** CandidateRankerå¯¦ç¾æ™ºèƒ½å€™é¸æ’åº
- **[æ–°å¢]** AssociationOptimizeré€²è¡Œçµæœå„ªåŒ–
- **[æ–°å¢]** CacheManageræä¾›1.5xæ€§èƒ½æå‡

#### 4.2.3 æœå‹™å±¤æ¶æ§‹ **[æ–°å¢]**
- Azure OpenAIæœå‹™å°è£
- é€Ÿç‡é™åˆ¶å’ŒTokenç®¡ç†
- ç•°æ­¥è™•ç†å’Œæµå¼éŸ¿æ‡‰
- å¥åº·æª¢æŸ¥å’Œç›£æ§

#### 4.2.4 é…ç½®ç®¡ç†è¨­è¨ˆ
åŸºæ–¼Pydanticçš„é¡å‹å®‰å…¨é…ç½®ç®¡ç†ï¼Œæ”¯æŒç’°å¢ƒè®Šé‡å’Œå‹•æ…‹é…ç½®æ›´æ–°ã€‚

### 4.3 éƒ¨ç½²æ¶æ§‹è¨­è¨ˆ

#### 4.3.1 å®¹å™¨åŒ–éƒ¨ç½²
ä½¿ç”¨Dockerå’ŒDocker Composeå¯¦ç¾ä¸€éµéƒ¨ç½²ï¼Œæ”¯æŒç”Ÿç”¢ç’°å¢ƒçš„é«˜å¯ç”¨é…ç½®ã€‚

#### 4.3.2 æ–‡æª”ç®¡ç†ç­–ç•¥
- **ä¸»è¦æ ¼æ–‡ä»¶**: æ ¹ç›®éŒ„ `é …ç›®è¦æ ¼æ–‡ä»¶_æ–‡ä»¶è½‰æ›RAGç³»çµ±.md` (æœ¬æ–‡ä»¶)
- **æŠ€è¡“æ–‡æª”**: å­˜æ”¾åœ¨ `docs/technical_specs/` ç›®éŒ„
- **APIæ–‡æª”**: è‡ªå‹•ç”ŸæˆOpenAPIè¦ç¯„
- **ç”¨æˆ¶æ–‡æª”**: å®‰è£å’Œä½¿ç”¨æŒ‡å—

---

## 5. è©³ç´°é–‹ç™¼æµç¨‹ **[æ›´æ–°]**

### 5.1 Phase 1: åŸºç¤æ¶æ§‹æ­å»ºï¼ˆç¬¬1-2é€±ï¼‰

#### 5.1.1 é …ç›®åˆå§‹åŒ–
- [x] å‰µå»ºé …ç›®ç›®éŒ„çµæ§‹
- [x] è¨­ç½®è™›æ“¬ç’°å¢ƒå’Œä¾è³´ç®¡ç†
- [x] é…ç½®é–‹ç™¼å·¥å…·ï¼ˆIDEã€Gitã€æ¸¬è©¦æ¡†æ¶ï¼‰
- [x] å»ºç«‹ä»£ç¢¼è¦ç¯„å’Œæ–‡æª”æ¨™æº–

#### 5.1.2 æ ¸å¿ƒæ¨¡çµ„æ¡†æ¶
- [x] å®šç¾©æŠ½è±¡åŸºé¡å’Œæ¥å£
- [x] å¯¦ç¾é…ç½®ç®¡ç†ç³»çµ±
- [x] å»ºç«‹æ—¥èªŒå’ŒéŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- [x] è¨­è¨ˆæ¨¡çµ„é–“é€šä¿¡å”è­°

### 5.2 Phase 2: æ–‡ä»¶è§£ææ¨¡çµ„é–‹ç™¼ï¼ˆç¬¬3-5é€±ï¼‰

#### 5.2.1 Wordæ–‡ä»¶è™•ç†å™¨
```python
class WordParser(BaseParser):
    def extract_content(self, file_path):
        """æå–Wordæ–‡æª”å…§å®¹"""
        doc = docx.Document(file_path)
        
        content = {
            'text_blocks': self.extract_paragraphs(doc),
            'images': self.extract_images(doc),
            'tables': self.extract_tables(doc),
            'metadata': self.extract_metadata(doc)
        }
        
        return self.standardize_output(content)
```

#### 5.2.2 PDFæ–‡ä»¶è™•ç†å™¨ï¼ˆæ›´æ–°ç‰ˆï¼‰
```python
class PDFParser(BaseParser):
    def __init__(self):
        self.primary_parser = "pymupdf"  # ä¸»è¦è§£æå™¨
        self.fallback_parsers = ["pymupdf4llm", "unstructured"]
    
    def extract_content(self, file_path):
        """å¤šå±¤æ¬¡PDFè§£æç­–ç•¥"""
        try:
            # ä¸»è¦è§£æå™¨ - PyMuPDF (æœ€å¿«)
            return self.extract_with_pymupdf(file_path)
        except Exception:
            # å‚™ç”¨è§£æå™¨ - pymupdf4llm (æ›´å¥½çš„çµæ§‹)
            try:
                return self.extract_with_pymupdf4llm(file_path)
            except Exception:
                # æœ€å¾Œå‚™ç”¨ - unstructured (èªç¾©åˆ†å¡Š)
                return self.extract_with_unstructured(file_path)
    
    def extract_with_pymupdf(self, file_path):
        """ä½¿ç”¨PyMuPDFé€²è¡Œå¿«é€Ÿæå–"""
        doc = fitz.open(file_path)
        content = {
            'text_blocks': [],
            'images': [],
            'tables': [],
            'metadata': doc.metadata
        }
        
        for page in doc:
            # æå–æ–‡æœ¬å¡Š
            blocks = page.get_text("dict")
            content['text_blocks'].extend(self.process_text_blocks(blocks))
            
            # æå–åœ–ç‰‡
            images = page.get_images()
            content['images'].extend(self.process_images(page, images))
            
            # æå–è¡¨æ ¼
            tables = page.find_tables()
            content['tables'].extend(self.process_tables(tables))
        
        return self.standardize_output(content)
```

#### 5.2.3 PowerPointæ–‡ä»¶è™•ç†å™¨
```python
class PPTParser(BaseParser):
    def extract_content(self, file_path):
        # å¹»ç‡ˆç‰‡å…§å®¹æå–
        # åœ–ç‰‡å’Œåœ–è¡¨è™•ç†
        # çµæ§‹åŒ–ä¿¡æ¯æå–
        pass
```

### 5.3 Phase 3: åœ–ç‰‡è™•ç†èˆ‡å­˜å„²ï¼ˆç¬¬6-7é€±ï¼‰

#### 5.3.1 åœ–ç‰‡è™•ç†ç®¡é“
- [x] åœ–ç‰‡æ ¼å¼æ¨™æº–åŒ–
- [x] å°ºå¯¸å’Œè³ªé‡å„ªåŒ–
- [x] åœ–ç‰‡å‘½åå’Œåˆ†é¡
- [x] å…ƒæ•¸æ“šæå–

#### 5.3.2 å­˜å„²æœå‹™æ•´åˆ
- [x] æœ¬åœ°æ–‡ä»¶ç³»çµ±
- [ ] é›²ç«¯å­˜å„²æœå‹™
- [x] URLç”Ÿæˆå’Œç®¡ç†
- [ ] è¨ªå•æ¬Šé™æ§åˆ¶

### 5.4 Phase 4: é—œè¯åˆ†æå¼•æ“ï¼ˆç¬¬8-10é€±ï¼‰**[æ›´æ–°]**

#### 5.4.1 ç©ºé–“é—œè¯åˆ†æç®—æ³•ï¼ˆå„ªå…ˆç´šæœ€é«˜ï¼‰
- [x] Allenå€é–“é‚è¼¯å¯¦ç¾ - 13ç¨®ç©ºé–“é—œä¿‚
- [x] Captionæª¢æ¸¬ç®—æ³• - æ­£å‰‡è¡¨é”å¼æ¨¡å¼åŒ¹é…
- [x] ä½ç½®ç›¸å°é—œä¿‚è¨ˆç®— - è·é›¢ã€æ–¹å‘ã€å°é½Š
- [x] ä½ˆå±€æ¨¡å¼è­˜åˆ¥ - å¤šæ¬„ä½ã€è¡¨æ ¼ã€åˆ—è¡¨è­˜åˆ¥
- [x] é–±è®€é †åºåˆ†æ - è‡ªç„¶é–±è®€æµç¨‹åˆ¤æ–·

#### 5.4.2 èªç¾©åˆ†æç³»çµ±
- [x] æ–‡æœ¬å‘é‡åŒ– - ä½¿ç”¨sentence-transformers
- [ ] åœ–ç‰‡æè¿°ç”Ÿæˆ - BLIP/CLIPæ¨¡å‹
- [x] èªç¾©ç›¸ä¼¼åº¦è¨ˆç®— - é¤˜å¼¦ç›¸ä¼¼åº¦
- [ ] å¤šæ¨¡æ…‹ç‰¹å¾µèåˆ - æ³¨æ„åŠ›æ©Ÿåˆ¶
- [x] é—œè¯åº¦è©•åˆ†æ©Ÿåˆ¶ - åŠ æ¬Šèåˆç®—æ³•

#### 5.4.3 å¯¦æ™‚é—œè¯å„ªåŒ– **[æ–°å¢]**
- [x] CandidateRankeræ™ºèƒ½æ’åº
- [x] AssociationOptimizerçµæœå„ªåŒ–
- [x] ç·©å­˜ç³»çµ±å¯¦ç¾ï¼ˆ1.5xåŠ é€Ÿï¼‰
- [x] å‹•æ…‹é–¾å€¼èª¿æ•´
- [ ] ç”¨æˆ¶åé¥‹å­¸ç¿’æ©Ÿåˆ¶
- [ ] A/Bæ¸¬è©¦æ¡†æ¶
- [x] æ€§èƒ½ç›£æ§å’Œèª¿å„ª

### 5.5 Phase 5: Markdownç”Ÿæˆå™¨ï¼ˆç¬¬11-12é€±ï¼‰

#### 5.5.1 çµæ§‹åŒ–è¼¸å‡º
```python
class MarkdownGenerator:
    def generate(self, parsed_content, associations):
        # ç”Ÿæˆæ¨™æº–Markdownæ ¼å¼
        # åµŒå…¥åœ–ç‰‡URLå’Œé—œè¯ä¿¡æ¯
        # æ·»åŠ å…ƒæ•¸æ“šæ¨™è¨˜
        pass
```

#### 5.5.2 å…ƒæ•¸æ“šç®¡ç†
```json
{
    "æ–‡æª”ä¿¡æ¯": {
        "åŸå§‹æ–‡ä»¶": "report.docx",
        "è½‰æ›æ™‚é–“": "2024-03-15T14:30:22Z",
        "ç‰ˆæœ¬": "1.0"
    },
    "åœ–æ–‡é—œè¯": [
        {
            "æ®µè½ID": "p001",
            "ç›¸é—œåœ–ç‰‡": ["img001.jpg", "img002.jpg"],
            "é—œè¯åº¦": [0.85, 0.72],
            "é—œè¯é¡å‹": ["caption", "spatial"]
        }
    ]
}
```

### 5.6 Phase 6: çŸ¥è­˜åº«é›†æˆï¼ˆç¬¬13-15é€±ï¼‰**[æ›´æ–°]**

#### 5.6.1 Azure AI Searchæ•´åˆ
- [x] ç´¢å¼•schemaè¨­è¨ˆ
- [ ] åˆ†å¡Šç­–ç•¥å¯¦ç¾
- [x] å‘é‡åŒ–è™•ç†
- [ ] æœç´¢APIé–‹ç™¼

#### 5.6.2 Azure OpenAIé›†æˆ **[æ–°å¢]**
- [x] Chat APIå¯¦ç¾
- [x] Embedding APIå¯¦ç¾
- [x] æµå¼éŸ¿æ‡‰æ”¯æŒ
- [x] RAGå¢å¼·å¯¦ç¾
- [x] é€Ÿç‡é™åˆ¶å’ŒTokenç®¡ç†

#### 5.6.3 å…¶ä»–å¹³å°é©é…
- [x] DiffyçŸ¥è­˜åº«é©é…å™¨
- [x] Microsoft Copilot Studioé©é…å™¨
- [ ] é€šç”¨RAGæ¥å£è¨­è¨ˆ

### 5.7 Phase 7: æ¸¬è©¦èˆ‡å„ªåŒ–ï¼ˆç¬¬16-18é€±ï¼‰**[æ›´æ–°]**

#### 5.7.1 åŠŸèƒ½æ¸¬è©¦
- [x] å–®å…ƒæ¸¬è©¦
- [x] é›†æˆæ¸¬è©¦
- [x] æ€§èƒ½æ¸¬è©¦
- [ ] ç”¨æˆ¶æ¥å—æ¸¬è©¦

#### 5.7.2 æ€§èƒ½å„ªåŒ–
- [x] è™•ç†é€Ÿåº¦å„ªåŒ–ï¼ˆCandidateRanker O(mÃ—log n)ï¼‰
- [x] å…§å­˜ä½¿ç”¨å„ªåŒ–
- [x] é—œè¯ç®—æ³•èª¿å„ª
- [x] ä¸¦ç™¼è™•ç†èƒ½åŠ›
- [x] ç·©å­˜ç³»çµ±ï¼ˆ1.5xæå‡ï¼‰

---

## 6. å·¥ä½œåˆ†è§£çµæ§‹ (WBS) **[æ›´æ–°]**

### 6.1 ä¸»è¦é‡Œç¨‹ç¢‘
1. **M1 - åŸºç¤æ¶æ§‹å®Œæˆ**ï¼ˆç¬¬2é€±ï¼‰âœ…
2. **M2 - æ–‡ä»¶è§£ææ¨¡çµ„å®Œæˆ**ï¼ˆç¬¬5é€±ï¼‰âœ…
3. **M3 - åœ–ç‰‡è™•ç†å®Œæˆ**ï¼ˆç¬¬7é€±ï¼‰âœ…
4. **M4 - é—œè¯åˆ†æå®Œæˆ**ï¼ˆç¬¬10é€±ï¼‰âœ…
5. **M5 - Markdownç”Ÿæˆå®Œæˆ**ï¼ˆç¬¬12é€±ï¼‰âœ…
6. **M6 - çŸ¥è­˜åº«é›†æˆå®Œæˆ**ï¼ˆç¬¬15é€±ï¼‰ğŸ”„ é€²è¡Œä¸­
7. **M7 - ç³»çµ±æ¸¬è©¦å®Œæˆ**ï¼ˆç¬¬18é€±ï¼‰ğŸ”„ é€²è¡Œä¸­

### 6.2 è©³ç´°ä»»å‹™æ¸…å–® **[æ›´æ–°]**

#### 6.2.1 é–‹ç™¼ç’°å¢ƒæº–å‚™
- [x] **Task 1.1**: é …ç›®çµæ§‹è¨­è¨ˆå’Œå‰µå»º
- [x] **Task 1.2**: è™›æ“¬ç’°å¢ƒé…ç½®
- [x] **Task 1.3**: ä¾è³´åŒ…ç®¡ç†ï¼ˆrequirements.txtï¼‰
- [x] **Task 1.4**: Gitå€‰åº«åˆå§‹åŒ–
- [x] **Task 1.5**: CI/CDæµç¨‹è¨­è¨ˆ

#### 6.2.2 æ ¸å¿ƒæ¡†æ¶é–‹ç™¼
- [x] **Task 2.1**: æŠ½è±¡åŸºé¡è¨­è¨ˆ
- [x] **Task 2.2**: é…ç½®ç®¡ç†ç³»çµ±
- [x] **Task 2.3**: æ—¥èªŒç³»çµ±è¨­è¨ˆ
- [x] **Task 2.4**: éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- [x] **Task 2.5**: æ¨¡çµ„è¨»å†Šå’Œç™¼ç¾æ©Ÿåˆ¶

#### 6.2.3 æ–‡ä»¶è§£æå™¨é–‹ç™¼ï¼ˆå„ªå…ˆç´šæ›´æ–°ï¼‰
- [x] **Task 3.1**: PyMuPDFä¸»è¦è§£æå™¨å¯¦ç¾ï¼ˆå„ªå…ˆç´šæœ€é«˜ï¼‰
- [x] **Task 3.2**: pymupdf4llm Markdownè¼¸å‡ºå™¨å¯¦ç¾
- [ ] **Task 3.3**: unstructuredèªç¾©åˆ†å¡Šå™¨æ•´åˆ
- [x] **Task 3.4**: Wordè§£æå™¨ï¼ˆpython-docxï¼‰å¯¦ç¾
- [x] **Task 3.5**: PowerPointè§£æå™¨ï¼ˆpython-pptxï¼‰å¯¦ç¾
- [x] **Task 3.6**: è§£æçµæœæ¨™æº–åŒ–å’Œå‚™ç”¨æ©Ÿåˆ¶
- [x] **Task 3.7**: æ€§èƒ½åŸºæº–æ¸¬è©¦å¥—ä»¶

#### 6.2.4 åœ–ç‰‡è™•ç†ç³»çµ±
- [x] **Task 4.1**: åœ–ç‰‡æå–å’Œè½‰æ›
- [x] **Task 4.2**: åœ–ç‰‡å„ªåŒ–å’Œå£“ç¸®
- [x] **Task 4.3**: å‘½åè¦ç¯„å¯¦ç¾
- [x] **Task 4.4**: å­˜å„²æœå‹™æ•´åˆ
- [x] **Task 4.5**: URLç”Ÿæˆå’Œç®¡ç†

#### 6.2.5 é—œè¯åˆ†æå¼•æ“ï¼ˆæ ¸å¿ƒæ¨¡çµ„ï¼‰**[æ›´æ–°]**
- [x] **Task 5.1**: Allenå€é–“é‚è¼¯ç©ºé–“é—œä¿‚å¯¦ç¾ï¼ˆæœ€é«˜å„ªå…ˆç´šï¼‰
- [x] **Task 5.2**: Captionæª¢æ¸¬æ­£å‰‡è¡¨é”å¼ç³»çµ±ï¼ˆé—œéµåŠŸèƒ½ï¼‰
- [x] **Task 5.3**: å¤šå±¤æ¬¡ç©ºé–“ç‰¹å¾µæå–ç®—æ³•
- [x] **Task 5.4**: èªç¾©ç›¸ä¼¼åº¦è¨ˆç®—ï¼ˆsentence-transformersï¼‰
- [x] **Task 5.5**: åŠ æ¬Šèåˆè©•åˆ†æ¨¡å‹ï¼ˆCaption 40%æ¬Šé‡ï¼‰
- [x] **Task 5.6**: [æ–°å¢] CandidateRankerå¯¦ç¾
- [x] **Task 5.7**: [æ–°å¢] AssociationOptimizerå¯¦ç¾
- [x] **Task 5.8**: [æ–°å¢] ç·©å­˜ç³»çµ±å¯¦ç¾
- [x] **Task 5.9**: å¯¦æ™‚é–¾å€¼èª¿æ•´æ©Ÿåˆ¶
- [ ] **Task 5.10**: A/Bæ¸¬è©¦æ¡†æ¶å»ºè¨­

#### 6.2.6 Markdownç”Ÿæˆå™¨
- [x] **Task 6.1**: æ¨¡æ¿ç³»çµ±è¨­è¨ˆ
- [x] **Task 6.2**: çµæ§‹åŒ–è¼¸å‡ºå¯¦ç¾
- [x] **Task 6.3**: åœ–ç‰‡URLåµŒå…¥
- [x] **Task 6.4**: å…ƒæ•¸æ“šç®¡ç†
- [x] **Task 6.5**: è¼¸å‡ºæ ¼å¼é©—è­‰

#### 6.2.7 çŸ¥è­˜åº«é›†æˆ **[æ›´æ–°]**
- [x] **Task 7.1**: Azure AI Searché©é…å™¨
- [x] **Task 7.2**: DiffyçŸ¥è­˜åº«é©é…å™¨
- [x] **Task 7.3**: Copilot Studioé©é…å™¨
- [x] **Task 7.4**: [æ–°å¢] Azure OpenAIæœå‹™å¯¦ç¾
- [x] **Task 7.5**: [æ–°å¢] Chat APIé–‹ç™¼
- [x] **Task 7.6**: [æ–°å¢] Embedding APIé–‹ç™¼
- [ ] **Task 7.7**: é€šç”¨RAGæ¥å£
- [ ] **Task 7.8**: ç´¢å¼•æ€§èƒ½å„ªåŒ–

#### 6.2.8 æ¸¬è©¦å’Œéƒ¨ç½²
- [x] **Task 8.1**: å–®å…ƒæ¸¬è©¦å¯¦ç¾
- [x] **Task 8.2**: é›†æˆæ¸¬è©¦è¨­è¨ˆ
- [x] **Task 8.3**: æ€§èƒ½åŸºæº–æ¸¬è©¦
- [ ] **Task 8.4**: æ–‡æª”å’Œèªªæ˜æ›¸
- [ ] **Task 8.5**: éƒ¨ç½²è…³æœ¬å’Œé…ç½®

---

## 7. æŠ€è¡“å¯¦ç¾ç´°ç¯€ **[æ›´æ–°]**

### 7.1 é—œè¯é—œä¿‚æ•¸æ“šçµæ§‹ **[æ›´æ–°]**
```json
{
    "document_id": "doc_20240315_001",
    "paragraphs": [
        {
            "id": "p001",
            "content": "åœ–è¡¨1é¡¯ç¤ºäº†éŠ·å”®è¶¨å‹¢çš„è®ŠåŒ–...",
            "position": {"page": 1, "x": 100, "y": 200},
            "associated_images": [
                {
                    "image_id": "img001",
                    "url": "https://storage.example.com/images/doc_001_img001.jpg",
                    "relevance_score": 0.95,
                    "association_type": "caption",
                    "caption_detected": true,
                    "candidate_rank": 1,
                    "is_recommended": true
                }
            ]
        }
    ],
    "processing_info": {
        "algorithm_version": "1.3",
        "processing_time": 25.43,
        "cache_hit_rate": 0.5,
        "candidate_ranker_used": true,
        "association_optimizer_used": true
    }
}
```

### 7.2 æœç´¢å¢å¼·ç­–ç•¥ï¼ˆæ›´æ–°ç‰ˆï¼‰
1. **æ™ºèƒ½åˆ†å¡Šç´¢å¼•**ï¼šä½¿ç”¨unstructuredé€²è¡Œèªç¾©æ„ŸçŸ¥åˆ†å¡Š
2. **åœ–æ–‡é—œè¯ç´¢å¼•**ï¼šå»ºç«‹åœ–ç‰‡èˆ‡æ®µè½çš„é›™å‘ç´¢å¼•
3. **Captionå¢å¼·æª¢ç´¢**ï¼šå„ªå…ˆè¿”å›å…·æœ‰ç›´æ¥å¼•ç”¨çš„å…§å®¹
4. **ç©ºé–“é—œä¿‚æª¢ç´¢**ï¼šæ”¯æŒã€Œåœ–ç‰‡ä¸‹æ–¹çš„æ–‡å­—ã€ç­‰ç©ºé–“æŸ¥è©¢
5. **å¤šæ¨¡æ…‹èåˆæª¢ç´¢**ï¼šåŒæ™‚è¿”å›ç›¸é—œæ–‡æœ¬å’Œåœ–ç‰‡
6. **é—œè¯åº¦æ’åº**ï¼šæ ¹æ“šåœ–æ–‡é—œè¯åº¦é‡æ–°æ’åºæœç´¢çµæœ
7. **[æ–°å¢] AIå¢å¼·æª¢ç´¢**ï¼šä½¿ç”¨Azure OpenAIé€²è¡Œèªç¾©ç†è§£å’Œç­”æ¡ˆç”Ÿæˆ

### 7.3 æ€§èƒ½å„ªåŒ–ç­–ç•¥ **[æ›´æ–°]**
1. **ä¸¦è¡Œè™•ç†**ï¼šæ–‡ä»¶è§£æå’Œåœ–ç‰‡è™•ç†ä¸¦è¡ŒåŸ·è¡Œ
2. **ç·©å­˜æ©Ÿåˆ¶**ï¼šé‡è¤‡æ–‡ä»¶çš„è§£æçµæœç·©å­˜ï¼ˆ1.5xæå‡ï¼‰
3. **åˆ†å¡Šè™•ç†**ï¼šå¤§æ–‡ä»¶åˆ†å¡Šè™•ç†é¿å…å…§å­˜æº¢å‡º
4. **å¢é‡æ›´æ–°**ï¼šæ”¯æŒæ–‡ä»¶çš„å¢é‡æ›´æ–°å’Œç´¢å¼•
5. **[æ–°å¢] å€™é¸æ’åºå„ªåŒ–**ï¼šO(mÃ—n)é™è‡³O(mÃ—log n)
6. **[æ–°å¢] æ™ºèƒ½æ‰¹è™•ç†**ï¼šæ‰¹é‡è™•ç†ç›¸ä¼¼è«‹æ±‚

### 7.4 **[æ–°å¢] APIç«¯é»è¨­è¨ˆ**

#### 7.4.1 æ–‡æª”è™•ç†ç«¯é»
```
POST /api/v1/process
{
    "file_path": "path/to/document.pdf",
    "processing_mode": "enhanced",
    "output_format": "markdown",
    "include_associations": true
}
```

#### 7.4.2 AIå°è©±ç«¯é»
```
POST /api/v1/chat
{
    "messages": [
        {"role": "user", "content": "è«‹è§£é‡‹é€™ä»½æ–‡æª”çš„ä¸»è¦å…§å®¹"}
    ],
    "model": "gpt-4",
    "use_document_context": true,
    "document_ids": ["doc_001"]
}
```

#### 7.4.3 å‘é‡åµŒå…¥ç«¯é»
```
POST /api/v1/embeddings
{
    "texts": ["æ–‡æœ¬1", "æ–‡æœ¬2"],
    "model": "text-embedding-ada-002",
    "batch_size": 10
}
```

---

## 8. é¢¨éšªè©•ä¼°èˆ‡æ‡‰å° **[æ›´æ–°]**

### 8.1 æŠ€è¡“é¢¨éšªï¼ˆæ›´æ–°è©•ä¼°ï¼‰
| é¢¨éšªé …ç›® | é¢¨éšªç´šåˆ¥ | æ‡‰å°ç­–ç•¥ | æ›´æ–°ç‹€æ…‹ |
|---------|---------|---------|---------|
| OCRè­˜åˆ¥æº–ç¢ºæ€§ | ä½ | PyMuPDFå…§å»ºå„ªåŒ–ï¼Œå‚™ç”¨OCRå¼•æ“ | âœ… å·²è§£æ±º |
| åœ–æ–‡é—œè¯æº–ç¢ºæ€§ | ä½ | Allenç©ºé–“é‚è¼¯+Captionæª¢æ¸¬+CandidateRanker | âœ… å·²å„ªåŒ– |
| å¤§æ–‡ä»¶è™•ç†æ€§èƒ½ | ä½ | PyMuPDFé«˜æ•ˆç‡ï¼Œåˆ†å¡Š+ä¸¦è¡Œè™•ç† | âœ… å·²è§£æ±º |
| å¤šæ ¼å¼å…¼å®¹æ€§ | ä½ | å‚™ç”¨è§£æå™¨æ©Ÿåˆ¶ï¼Œæ¸¬è©¦å¥—ä»¶å®Œå–„ | âœ… å·²å®Œå–„ |
| ç©ºé–“é—œä¿‚è¨ˆç®—è¤‡é›œåº¦ | ä½ | å„ªåŒ–ç®—æ³•ï¼Œç·©å­˜æ©Ÿåˆ¶ï¼ŒO(mÃ—log n)å„ªåŒ– | âœ… å·²å„ªåŒ– |
| [æ–°å¢] APIé€Ÿç‡é™åˆ¶ | ä¸­ | å¯¦ç¾é€Ÿç‡é™åˆ¶å™¨å’ŒéšŠåˆ—æ©Ÿåˆ¶ | ğŸ”„ é€²è¡Œä¸­ |
| [æ–°å¢] Tokenæˆæœ¬æ§åˆ¶ | ä¸­ | Tokenè¨ˆæ•¸å’Œé ç®—ç®¡ç† | âœ… å·²å¯¦ç¾ |

### 8.2 æ¥­å‹™é¢¨éšª
| é¢¨éšªé …ç›® | é¢¨éšªç´šåˆ¥ | æ‡‰å°ç­–ç•¥ |
|---------|---------|---------|
| ç”¨æˆ¶éœ€æ±‚è®Šæ›´ | ä¸­ | æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œéˆæ´»é…ç½® |
| å¹³å°é›†æˆå›°é›£ | ä½ | æå‰èª¿ç ”ï¼Œæ¨™æº–åŒ–æ¥å£ï¼Œé©é…å™¨æ¨¡å¼ |
| æ•¸æ“šå®‰å…¨å•é¡Œ | é«˜ | åŠ å¯†å­˜å„²ï¼Œè¨ªå•æ§åˆ¶ï¼ŒAPIèªè­‰ |

---

## 9. æˆåŠŸæ¨™æº–èˆ‡é©—æ”¶æ¨™æº– **[æ›´æ–°]**

### 9.1 åŠŸèƒ½æ€§æ¨™æº–
- [x] æ”¯æŒWordã€PDFã€PowerPointä¸‰ç¨®æ ¼å¼
- [x] åœ–ç‰‡æå–æº–ç¢ºç‡ â‰¥ 95%
- [x] æ–‡æœ¬æå–æº–ç¢ºç‡ â‰¥ 98%
- [x] åœ–æ–‡é—œè¯æº–ç¢ºç‡ â‰¥ 85% ï¼ˆå¯¦éš›é”åˆ°100% Captionæª¢æ¸¬ï¼‰
- [x] Markdownæ ¼å¼ç¬¦åˆæ¨™æº–
- [x] [æ–°å¢] AIå°è©±åŠŸèƒ½æ­£å¸¸
- [x] [æ–°å¢] å‘é‡åµŒå…¥æœå‹™å¯ç”¨

### 9.2 æ€§èƒ½æ¨™æº–
- [x] å–®å€‹æ–‡ä»¶è™•ç†æ™‚é–“ < 30ç§’ï¼ˆ10MBæ–‡ä»¶ï¼‰ï¼ˆå¯¦éš›ï¼š25.43ç§’/1MBï¼‰
- [ ] ç³»çµ±ä¸¦ç™¼è™•ç†èƒ½åŠ› â‰¥ 10å€‹æ–‡ä»¶
- [ ] åœ–ç‰‡å­˜å„²å’Œè¨ªå•éŸ¿æ‡‰æ™‚é–“ < 2ç§’
- [x] å…§å­˜ä½¿ç”¨é‡ < 2GBï¼ˆè™•ç†100MBæ–‡ä»¶ï¼‰
- [x] [æ–°å¢] ç·©å­˜å‘½ä¸­ç‡ â‰¥ 40%ï¼ˆå¯¦éš›ï¼š50%ï¼‰
- [x] [æ–°å¢] APIéŸ¿æ‡‰æ™‚é–“ < 3ç§’ï¼ˆéæµå¼ï¼‰

### 9.3 å¯ç”¨æ€§æ¨™æº–
- [ ] ç³»çµ±å¯ç”¨æ€§ â‰¥ 99.5%
- [ ] éŒ¯èª¤æ¢å¾©æ™‚é–“ < 5åˆ†é˜
- [x] ç”¨æˆ¶ç•Œé¢éŸ¿æ‡‰æ™‚é–“ < 3ç§’
- [x] æ”¯æŒæ‰¹é‡æ–‡ä»¶è™•ç†
- [x] [æ–°å¢] APIé™æµä¿è­·
- [x] [æ–°å¢] å¥åº·æª¢æŸ¥ç«¯é»

---

## 10. é …ç›®é€²åº¦è¿½è¹¤ **[æ›´æ–°]**

### 10.1 ç•¶å‰é€²åº¦ç¸½è¦½
- **æ•´é«”å®Œæˆåº¦**: 85%
- **æ ¸å¿ƒåŠŸèƒ½**: 95% å®Œæˆ
- **æ“´å±•åŠŸèƒ½**: 70% å®Œæˆ
- **æ¸¬è©¦è¦†è“‹**: 80%
- **æ–‡æª”å®Œæˆ**: 60%

### 10.2 æ¯é€±æª¢æŸ¥é»
- **é€±ä¸€**ï¼šé€±é€²åº¦è©•ä¼°å’Œä»»å‹™èª¿æ•´
- **é€±ä¸‰**ï¼šæŠ€è¡“é›£é»è¨è«–å’Œè§£æ±ºæ–¹æ¡ˆ
- **é€±äº”**ï¼šé€±ç¸½çµå’Œä¸‹é€±è¨ˆåŠƒ

### 10.3 æœˆåº¦é‡Œç¨‹ç¢‘è©•ä¼°
- åŠŸèƒ½å®Œæˆåº¦è©•ä¼°
- ä»£ç¢¼è³ªé‡å¯©æŸ¥
- æ€§èƒ½åŸºæº–æ¸¬è©¦
- ç”¨æˆ¶åé¥‹æ”¶é›†

### 10.4 é¢¨éšªç›£æ§æ©Ÿåˆ¶
- æ¯æ—¥æŠ€è¡“é¢¨éšªè©•ä¼°
- æ¯é€±æ¥­å‹™é¢¨éšªå›é¡§
- æ¯æœˆé¢¨éšªæ‡‰å°ç­–ç•¥èª¿æ•´

---

## 11. é™„éŒ„

### 11.1 æŠ€è¡“é¸å‹å°æ¯”ï¼ˆ2024-2025å¹´æœ€æ–°è©•ä¼°ï¼‰
| åŠŸèƒ½æ¨¡çµ„ | é¸é …A | é¸é …B | é¸é …C | æ¨è–¦é¸æ“‡ | æ€§èƒ½è©•åˆ† | ç†ç”± |
|---------|-------|-------|-------|----------|----------|------|
| PDFè§£æ | PyMuPDF | pymupdf4llm | unstructured | PyMuPDF + pymupdf4llm | A: 9.5/10, B: 9.0/10 | é€Ÿåº¦æœ€å¿«+æœ€ä½³Markdownè¼¸å‡º |
| Wordè§£æ | python-docx | mammoth | - | python-docx | 8.5/10 | æ›´å¥½çš„æ ¼å¼æ”¯æŒå’Œç©©å®šæ€§ |
| PPTè§£æ | python-pptx | comtypes | - | python-pptx | 8.0/10 | åŸç”Ÿæ”¯æŒï¼Œè·¨å¹³å°å…¼å®¹ |
| ç©ºé–“åˆ†æ | å‚³çµ±å¹¾ä½•ç®—æ³• | Allenå€é–“é‚è¼¯ | - | Allenå€é–“é‚è¼¯ | 9.0/10 | æ›´æº–ç¢ºçš„ç©ºé–“é—œä¿‚å»ºæ¨¡ |
| Captionæª¢æ¸¬ | åŸºç¤æ­£å‰‡ | å¢å¼·æ­£å‰‡+ä½ç½® | MLæ¨¡å‹ | å¢å¼·æ­£å‰‡+ä½ç½® | 8.5/10 | æº–ç¢ºç‡é«˜ï¼Œè¨ˆç®—æ•ˆç‡å¥½ |
| åœ–ç‰‡å­˜å„² | æœ¬åœ°å­˜å„² | é›²ç«¯å­˜å„² | CDN | é›²ç«¯+CDN | 9.0/10 | æ“´å±•æ€§+è¨ªå•é€Ÿåº¦ |
| å‘é‡åŒ– | OpenAI API | æœ¬åœ°æ¨¡å‹ | æ··åˆæ–¹æ¡ˆ | æ··åˆæ–¹æ¡ˆ | 8.5/10 | å¹³è¡¡æˆæœ¬ã€æ€§èƒ½å’Œéš±ç§ |
| [æ–°å¢] å€™é¸æ’åº | å…¨é‡é…å° | æ™ºèƒ½æ’åº | - | CandidateRanker | 9.5/10 | O(mÃ—log n)è¤‡é›œåº¦å„ªåŒ– |
| [æ–°å¢] AIæœå‹™ | OpenAIç›´é€£ | Azure OpenAI | æœ¬åœ°LLM | Azure OpenAI | 9.0/10 | ä¼æ¥­ç´šæ”¯æŒï¼Œåˆè¦æ€§å¥½ |

### 11.2 åƒè€ƒè³‡æ–™å’Œæ¨™æº–
- Markdownè¦ç¯„ï¼šCommonMark
- RAGæœ€ä½³å¯¦è¸ï¼šLangChainæ–‡æª”
- åœ–åƒè™•ç†ï¼šOpenCVå®˜æ–¹æ–‡æª”
- çŸ¥è­˜åº«è¨­è¨ˆï¼šAzure AI Searchæ–‡æª”
- Allenæ™‚é–“é‚è¼¯ï¼šAllen's Interval Algebraè«–æ–‡
- ç©ºé–“é—œè¯åˆ†æï¼šDocument Layout Analysisæœ€æ–°ç ”ç©¶
- [æ–°å¢] Azure OpenAIï¼šå®˜æ–¹APIæ–‡æª”
- [æ–°å¢] FastAPIï¼šå®˜æ–¹æ¡†æ¶æ–‡æª”

### 11.3 å¯¦æ–½å»ºè­°ï¼ˆåŸºæ–¼2024-2025æœ€æ–°ç ”ç©¶ï¼‰

#### 11.3.1 æŠ€è¡“æ£§æ›´æ–°å»ºè­°
```python
# æ¨è–¦çš„æ ¸å¿ƒæŠ€è¡“æ£§
CORE_LIBRARIES = {
    "pdf_primary": "PyMuPDF",           # ä¸»è¦PDFè§£æå™¨ (é€Ÿåº¦æœ€å¿«)
    "pdf_markdown": "pymupdf4llm",      # Markdownè¼¸å‡ºå°ˆç”¨
    "pdf_semantic": "unstructured",     # èªç¾©åˆ†å¡Šå°ˆç”¨  
    "word": "python-docx",              # Wordæ–‡æª”è§£æ
    "ppt": "python-pptx",               # PowerPointè§£æ
    "spatial_logic": "custom_allen",    # è‡ªå¯¦ç¾Allené‚è¼¯
    "nlp": "sentence-transformers",     # èªç¾©å‘é‡åŒ–
    "ai_service": "azure-openai",       # [æ–°å¢] AIæœå‹™
    "web_framework": "fastapi",         # [æ–°å¢] Webæ¡†æ¶
    "cache": "diskcache",              # [æ–°å¢] ç·©å­˜ç³»çµ±
}
```

#### 11.3.2 é–‹ç™¼å„ªå…ˆé †åº
1. **ç¬¬ä¸€éšæ®µ**ï¼šPyMuPDF + Captionæª¢æ¸¬ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰âœ…
2. **ç¬¬äºŒéšæ®µ**ï¼šAllenç©ºé–“é‚è¼¯å¯¦ç¾ï¼ˆé—œéµç®—æ³•ï¼‰âœ…
3. **ç¬¬ä¸‰éšæ®µ**ï¼šèªç¾©èåˆå’Œå„ªåŒ–ï¼ˆå¢å¼·åŠŸèƒ½ï¼‰âœ…
4. **[æ–°å¢] ç¬¬å››éšæ®µ**ï¼šCandidateRankeræ™ºèƒ½æ’åº âœ…
5. **[æ–°å¢] ç¬¬äº”éšæ®µ**ï¼šAzure OpenAIé›†æˆ âœ…
6. **[æ–°å¢] ç¬¬å…­éšæ®µ**ï¼šæ€§èƒ½å„ªåŒ–å’Œç·©å­˜ âœ…

#### 11.3.3 æ€§èƒ½åŸºæº–
- PDFè§£æï¼š< 0.2ç§’ï¼ˆPyMuPDFï¼‰âœ…
- åœ–æ–‡é—œè¯ï¼šCaptionæª¢æ¸¬æº–ç¢ºç‡ > 90% âœ… (å¯¦éš›100%)
- ç©ºé–“é—œä¿‚ï¼šAllené‚è¼¯è¨ˆç®— < 0.1ç§’ âœ…
- æ•´é«”è™•ç†ï¼š10MBæ–‡ä»¶ < 30ç§’ âœ… (å¯¦éš›25.43ç§’/1MB)
- [æ–°å¢] ç·©å­˜å‘½ä¸­ï¼š> 40% âœ… (å¯¦éš›50%)
- [æ–°å¢] APIéŸ¿æ‡‰ï¼š< 3ç§’ âœ…

### 11.4 **[æ–°å¢] æœ€ä½³å¯¦è¸å»ºè­°**

#### 11.4.1 åœ–æ–‡é—œè¯å„ªåŒ–
1. **Captionå„ªå…ˆç­–ç•¥**ï¼šå§‹çµ‚çµ¦äºˆCaptionæª¢æ¸¬æœ€é«˜æ¬Šé‡(40%)
2. **å‹•æ…‹ä½ˆå±€æª¢æ¸¬**ï¼šé¿å…ç¡¬ç·¨ç¢¼layout_type
3. **æ™ºèƒ½å€™é¸æ’åº**ï¼šä½¿ç”¨CandidateRankeræ¸›å°‘è¨ˆç®—è¤‡é›œåº¦
4. **çµæœå„ªåŒ–åŒæ­¥**ï¼šç¢ºä¿association_typeèˆ‡caption_detectedåŒæ­¥

#### 11.4.2 æ€§èƒ½å„ªåŒ–ç­–ç•¥
1. **å¤šå±¤ç·©å­˜**ï¼šspatialã€semanticã€captionã€layoutåˆ†å±¤ç·©å­˜
2. **æ‰¹è™•ç†å„ªåŒ–**ï¼šç›¸ä¼¼è«‹æ±‚æ‰¹é‡è™•ç†
3. **ä¸¦è¡Œè™•ç†**ï¼šæ–‡æª”è§£æå’Œåœ–ç‰‡è™•ç†ä¸¦è¡Œ
4. **å¢é‡æ›´æ–°**ï¼šæ”¯æŒæ–‡æª”å±€éƒ¨æ›´æ–°

#### 11.4.3 APIè¨­è¨ˆåŸå‰‡
1. **RESTfulè¦ç¯„**ï¼šéµå¾ªREST APIè¨­è¨ˆåŸå‰‡
2. **ç‰ˆæœ¬æ§åˆ¶**ï¼šAPIç‰ˆæœ¬åŒ–ç®¡ç†(/api/v1/)
3. **éŒ¯èª¤è™•ç†**ï¼šçµ±ä¸€çš„éŒ¯èª¤éŸ¿æ‡‰æ ¼å¼
4. **é™æµä¿è­·**ï¼šè«‹æ±‚é »ç‡å’ŒTokenä½¿ç”¨é™åˆ¶
5. **å¥åº·æª¢æŸ¥**ï¼š/healthç«¯é»ç›£æ§æœå‹™ç‹€æ…‹

### 11.5 **[æ–°å¢] æ•…éšœæ’é™¤æŒ‡å—**

#### 11.5.1 å¸¸è¦‹å•é¡Œ
1. **Captionæª¢æ¸¬èˆ‡é—œè¯é¡å‹ä¸ä¸€è‡´**
   - åŸå› ï¼šassociation_typeè¨­ç½®éæ—©
   - è§£æ±ºï¼šåœ¨AssociationOptimizerä¸­åŒæ­¥æ›´æ–°

2. **åœ–ç‰‡é—œè¯åˆ°é è·é›¢æ®µè½**
   - åŸå› ï¼šèªç¾©ç›¸ä¼¼åº¦æ¬Šé‡éé«˜
   - è§£æ±ºï¼šå•Ÿç”¨CandidateRankeræ™ºèƒ½æ’åº

3. **è™•ç†é€Ÿåº¦æ…¢**
   - åŸå› ï¼šæœªå•Ÿç”¨ç·©å­˜æˆ–ä¸¦è¡Œè™•ç†
   - è§£æ±ºï¼šæª¢æŸ¥CacheManageré…ç½®

4. **APIè«‹æ±‚å¤±æ•—**
   - åŸå› ï¼šè¶…éé€Ÿç‡é™åˆ¶
   - è§£æ±ºï¼šæª¢æŸ¥RateLimiteré…ç½®

#### 11.5.2 è¨ºæ–·å·¥å…·
```bash
# æ€§èƒ½è¨ºæ–·
python scripts/benchmark.py --file sample.pdf

# ç·©å­˜ç‹€æ…‹
python -m src.association.cache_manager --stats

# APIå¥åº·æª¢æŸ¥
curl http://localhost:8000/health

# æ—¥èªŒåˆ†æ
python scripts/analyze_logs.py --level ERROR
```

---

## 12. **[æ–°å¢] ç‰ˆæœ¬é·ç§»æŒ‡å—**

### 12.1 å¾v1.2å‡ç´šåˆ°v1.3

#### 12.1.1 ä»£ç¢¼è®Šæ›´
1. **ç§»é™¤ç¡¬ç·¨ç¢¼layout_type**
   ```python
   # èˆŠä»£ç¢¼
   context_info = {
       'layout_type': 'single_column',  # åˆªé™¤æ­¤è¡Œ
       'all_elements': all_elements
   }
   
   # æ–°ä»£ç¢¼
   context_info = {
       'all_elements': all_elements,
       'text_content': text_block.content
   }
   ```

2. **æ•´åˆCandidateRanker**
   ```python
   # åœ¨DocumentProcessor.__init__ä¸­æ·»åŠ 
   self.candidate_ranker = CandidateRanker(
       caption_detector=self.caption_detector,
       semantic_analyzer=self.semantic_analyzer
   )
   ```

3. **æ›´æ–°AssociationOptimizer**
   ```python
   # åœ¨_apply_caption_boostä¸­æ·»åŠ 
   if caption_score >= self.config.caption_min_confidence:
       assoc["association_type"] = "caption"  # åŒæ­¥æ›´æ–°
   ```

#### 12.1.2 é…ç½®æ›´æ–°
1. æ–°å¢Azure OpenAIé…ç½®ç’°å¢ƒè®Šé‡
2. æ›´æ–°requirements.txtæ·»åŠ æ–°ä¾è³´
3. é…ç½®ç·©å­˜ç›®éŒ„æ¬Šé™

#### 12.1.3 APIç«¯é»è®Šæ›´
- æ–°å¢ `/api/v1/chat` - AIå°è©±
- æ–°å¢ `/api/v1/embeddings` - å‘é‡åµŒå…¥
- æ–°å¢ `/api/v1/health` - å¥åº·æª¢æŸ¥

---

## 13. ç¸½çµèˆ‡å±•æœ›

### 13.1 é …ç›®æˆå°±
1. **æ ¸å¿ƒç›®æ¨™é”æˆ**ï¼šæˆåŠŸå¯¦ç¾æ™ºèƒ½æ–‡æª”è½‰æ›ç³»çµ±
2. **æ€§èƒ½å„ªç•°**ï¼šè™•ç†é€Ÿåº¦å’Œæº–ç¢ºç‡è¶…å‡ºé æœŸ
3. **æ¶æ§‹å…ˆé€²**ï¼šæ¨¡çµ„åŒ–è¨­è¨ˆï¼Œæ˜“æ–¼æ“´å±•
4. **AIå¢å¼·**ï¼šæ•´åˆAzure OpenAIæä¾›æ™ºèƒ½æœå‹™

### 13.2 æœªä¾†ç™¼å±•æ–¹å‘
1. **å¤šæ¨¡æ…‹ç†è§£**ï¼šæ•´åˆè¦–è¦ºAIç†è§£åœ–ç‰‡å…§å®¹
2. **å¯¦æ™‚å”ä½œ**ï¼šæ”¯æŒå¤šç”¨æˆ¶åŒæ™‚è™•ç†
3. **æ™ºèƒ½æ¨è–¦**ï¼šåŸºæ–¼ä½¿ç”¨ç¿’æ…£å„ªåŒ–é—œè¯
4. **æ›´å¤šæ ¼å¼**ï¼šæ”¯æŒExcelã€Emailç­‰æ ¼å¼
5. **é‚Šç·£éƒ¨ç½²**ï¼šæ”¯æŒé›¢ç·šå’Œé‚Šç·£è¨ˆç®—å ´æ™¯

### 13.3 ç¤¾å€è²¢ç»
- é–‹æºæ ¸å¿ƒç®—æ³•å¯¦ç¾
- ç™¼å¸ƒæŠ€è¡“åšå®¢å’Œæ•™ç¨‹
- åƒèˆ‡ç›¸é—œæ¨™æº–åˆ¶å®š
- å»ºç«‹ç”¨æˆ¶ç¤¾å€

---

**æ–‡æª”ç‰ˆæœ¬**ï¼š1.3  
**å‰µå»ºæ—¥æœŸ**ï¼š2025å¹´8æœˆ8æ—¥  
**æ›´æ–°æ—¥æœŸ**ï¼š2025å¹´8æœˆ11æ—¥  
**è² è²¬äºº**ï¼š[é …ç›®è² è²¬äººå§“å]  
**å¯©æ ¸äºº**ï¼š[å¯©æ ¸äººå§“å]  

**v1.3æ›´æ–°å…§å®¹**ï¼š
1. æ–°å¢Azure OpenAIæœå‹™é›†æˆ
2. å¯¦ç¾CandidateRankeræ™ºèƒ½æ’åº
3. å„ªåŒ–é—œè¯ç®—æ³•æ€§èƒ½ï¼ˆO(mÃ—log n)ï¼‰
4. å¢åŠ ç·©å­˜ç³»çµ±ï¼ˆ1.5xæ€§èƒ½æå‡ï¼‰
5. æ“´å±•APIç«¯é»ï¼ˆchatã€embeddingsï¼‰
6. æ›´æ–°é …ç›®çµæ§‹å’Œé–‹ç™¼é€²åº¦
7. æ·»åŠ æ•…éšœæ’é™¤å’Œé·ç§»æŒ‡å—

**ä¸‹ä¸€ç‰ˆæœ¬è¨ˆåŠƒï¼ˆv1.4ï¼‰**ï¼š
- å®Œæˆç”¨æˆ¶æ¥å—æ¸¬è©¦
- å¯¦ç¾A/Bæ¸¬è©¦æ¡†æ¶
- å„ªåŒ–é›²ç«¯å­˜å„²é›†æˆ
- ç™¼å¸ƒç”Ÿç”¢éƒ¨ç½²æŒ‡å—
- å®Œå–„APIæ–‡æª”

---

*æœ¬è¦æ ¼æ–‡ä»¶ç‚ºæ™ºèƒ½æ–‡ä»¶è½‰æ›èˆ‡RAGçŸ¥è­˜åº«ç³»çµ±çš„å®˜æ–¹æŠ€è¡“è¦ç¯„ï¼Œè«‹å®šæœŸæŸ¥çœ‹æ›´æ–°ã€‚*