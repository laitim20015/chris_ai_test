# {{ document.metadata.filename }}

{% if metadata %}
{{ metadata.to_yaml_frontmatter() }}

{% endif %}

## 📋 文檔概覽

| 項目 | 詳情 |
|------|------|
| 📄 原始文件 | {{ document.metadata.filename }} |
| 📊 頁數 | {{ document.metadata.page_count }} |
| 🖼️ 圖片數量 | {{ document.images|length }} |
| 🔗 關聯數量 | {{ associations|length }} |
| ⏱️ 處理時間 | {{ generation_time.strftime('%Y-%m-%d %H:%M:%S') }} |

---

## 📝 文檔內容

{% for block_data in text_blocks_with_images %}
### 段落 {{ loop.index }}

{{ block_data.text_block.content }}

{% if block_data.related_images %}
#### 📸 相關圖片

{% for image_data in block_data.related_images %}
<div class="image-association">

![{{ image_data.image.alt_text or 'Image' }}](./images/{{ image_data.image.filename or (image_data.image.id + '.png') }})

**圖片信息:**
- 🎯 關聯度: {{ "%.3f"|format(image_data.association.score) }}
- 📍 關聯類型: {{ image_data.association.association_type }}
- 🔍 Caption檢測: {{ '✅' if image_data.association.caption_detected else '❌' }}

</div>

{% endfor %}
{% endif %}

---

{% endfor %}

{% if tables %}
## 📊 數據表格

{% for table in tables %}
### 表格 {{ loop.index }}

{% if table.headers %}
| {{ table.headers|join(' | ') }} |
|{{ table.headers|map('replace', table.headers[0], ' --- ')|join('|') }}|
{% for row in table.rows[:10] %}
| {{ row|join(' | ') }} |
{% endfor %}

{% if table.rows|length > 10 %}
*註: 僅顯示前10行數據*
{% endif %}
{% endif %}

{% endfor %}
{% endif %}

---

## 🔍 處理詳情

{% if associations %}
### 圖文關聯分析

| 文本塊 | 圖片 | 關聯度 | 類型 | Caption |
|--------|------|--------|------|---------|
{% for assoc in associations %}
| {{ assoc.text_block_id }} | {{ assoc.image_id }} | {{ "%.3f"|format(assoc.score) }} | {{ assoc.association_type }} | {{ '✅' if assoc.caption_detected else '❌' }} |
{% endfor %}
{% endif %}

*Generated by 智能文件轉換與RAG知識庫系統 v{{ metadata.version if metadata else '1.0' }}*
